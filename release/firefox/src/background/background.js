var _=function(h){"use strict";var ke=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ie={exports:{}};(function(e,t){(function(r,s){s(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ke,function(r){var s,o;if(!((o=(s=globalThis.chrome)==null?void 0:s.runtime)!=null&&o.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const l="The message port closed before a response was received.",u=d=>{const w={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(w).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class S extends WeakMap{constructor(i,g=void 0){super(g),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}const R=n=>n&&typeof n=="object"&&typeof n.then=="function",E=(n,i)=>(...g)=>{d.runtime.lastError?n.reject(new Error(d.runtime.lastError.message)):i.singleCallbackArg||g.length<=1&&i.singleCallbackArg!==!1?n.resolve(g[0]):n.resolve(g)},z=n=>n==1?"argument":"arguments",at=(n,i)=>function(m,...b){if(b.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${z(i.minArgs)} for ${n}(), got ${b.length}`);if(b.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${z(i.maxArgs)} for ${n}(), got ${b.length}`);return new Promise((x,v)=>{if(i.fallbackToNoCallback)try{m[n](...b,E({resolve:x,reject:v},i))}catch(c){console.warn(`${n} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,c),m[n](...b),i.fallbackToNoCallback=!1,i.noCallback=!0,x()}else i.noCallback?(m[n](...b),x()):m[n](...b,E({resolve:x,reject:v},i))})},he=(n,i,g)=>new Proxy(i,{apply(m,b,x){return g.call(b,n,...x)}});let Z=Function.call.bind(Object.prototype.hasOwnProperty);const Y=(n,i={},g={})=>{let m=Object.create(null),b={has(v,c){return c in n||c in m},get(v,c,k){if(c in m)return m[c];if(!(c in n))return;let A=n[c];if(typeof A=="function")if(typeof i[c]=="function")A=he(n,n[c],i[c]);else if(Z(g,c)){let M=at(c,g[c]);A=he(n,n[c],M)}else A=A.bind(n);else if(typeof A=="object"&&A!==null&&(Z(i,c)||Z(g,c)))A=Y(A,i[c],g[c]);else if(Z(g,"*"))A=Y(A,i[c],g["*"]);else return Object.defineProperty(m,c,{configurable:!0,enumerable:!0,get(){return n[c]},set(M){n[c]=M}}),A;return m[c]=A,A},set(v,c,k,A){return c in m?m[c]=k:n[c]=k,!0},defineProperty(v,c,k){return Reflect.defineProperty(m,c,k)},deleteProperty(v,c){return Reflect.deleteProperty(m,c)}},x=Object.create(n);return new Proxy(x,b)},ae=n=>({addListener(i,g,...m){i.addListener(n.get(g),...m)},hasListener(i,g){return i.hasListener(n.get(g))},removeListener(i,g){i.removeListener(n.get(g))}}),ot=new S(n=>typeof n!="function"?n:function(g){const m=Y(g,{},{getContent:{minArgs:0,maxArgs:0}});n(m)}),xe=new S(n=>typeof n!="function"?n:function(g,m,b){let x=!1,v,c=new Promise($=>{v=function(P){x=!0,$(P)}}),k;try{k=n(g,m,v)}catch($){k=Promise.reject($)}const A=k!==!0&&R(k);if(k!==!0&&!A&&!x)return!1;const M=$=>{$.then(P=>{b(P)},P=>{let ne;P&&(P instanceof Error||typeof P.message=="string")?ne=P.message:ne="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:ne})}).catch(P=>{console.error("Failed to send onMessage rejected reply",P)})};return M(A?k:c),!0}),nt=({reject:n,resolve:i},g)=>{d.runtime.lastError?d.runtime.lastError.message===l?i():n(new Error(d.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?n(new Error(g.message)):i(g)},ve=(n,i,g,...m)=>{if(m.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${z(i.minArgs)} for ${n}(), got ${m.length}`);if(m.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${z(i.maxArgs)} for ${n}(), got ${m.length}`);return new Promise((b,x)=>{const v=nt.bind(null,{resolve:b,reject:x});m.push(v),g.sendMessage(...m)})},it={devtools:{network:{onRequestFinished:ae(ot)}},runtime:{onMessage:ae(xe),onMessageExternal:ae(xe),sendMessage:ve.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:ve.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},oe={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return w.privacy={network:{"*":oe},services:{"*":oe},websites:{"*":oe}},Y(d,it,w)};r.exports=u(chrome)}else r.exports=globalThis.browser})})(ie);var Te=ie.exports;const a=pe(Te);async function G(e,t){try{return await a.storage.local.set({[e]:t}),!0}catch(r){return console.log("Error saving to browser ",r),!1}}async function F(e){try{const t=await a.storage.local.get(e);return t[e]!==void 0?t[e]:{}}catch(t){return console.log("Error getting data from browser ",t),{}}}let j,O,y,U=!1,J=!1,L={};const X=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let C=!0,B=!1,I=!1,N=0,D="";async function Q(){try{const e=await Le();return L={},Array.isArray(e)&&e.forEach(t=>{if(t.target!==""){const r=Fe(t.target);r&&(L[r]=t.redirect)}}),console.log("list url updated: ",L),!0}catch(e){return console.log(e),!1}}async function Ee(){try{const e=await a.storage.local.get("state");if(console.log("state when start",e.state),e.state){const t=await a.storage.local.get("clock");y=t.clock,U=!0;const r=await a.storage.local.get("block"),s=await a.storage.local.get("blocktime"),o=await a.storage.local.get("breaktime");console.log("clock ",t.clock),console.log("blocktime ",s.blocktime),console.log("breaktime ",o.breaktime),r.block?q(s.blocktime,o.breaktime):K(s.blocktime,o.breaktime)}}catch{console.log("error when get current state of extension")}}async function Pe(e){try{const t=await F("list-card"),r=Array.isArray(t)?t:[],s=[e,...r],o=await G("list-card",s),l=await Q();await a.storage.local.remove("temp"),console.log("remove successfully");const u=await a.storage.local.get("temp");return console.log("d ",u),se(),o&&l}catch(t){return console.log(t),!1}}async function Se(e){try{const t=await F("list-card");console.log("list",t),Array.isArray(t)?e(t):e([])}catch(t){console.log(t)}}async function Le(){try{const e=await F("list-card");return e||[]}catch(e){return console.log(e),[]}}async function Ce(e){try{const r=(await F("list-card")).filter(l=>l.index!==e),s=await G("list-card",r);console.log("new card ",r);const o=await Q();return s&&o}catch(t){return console.log(t),!1}}async function V(e){try{const t=await G("state",e);return console.log("state update ",e),t}catch(t){return console.log(t),!1}}async function ee(e){try{const t=await G("block",e);return console.log("block update ",e),t}catch(t){return console.log(t),!1}}async function De(e){try{const t=await a.storage.local.get("state"),r=await a.storage.local.get("block"),s=await a.storage.local.get("breaktime"),o=await a.storage.local.get("blocktime"),l=await a.storage.local.get("clock"),u=t&&t.state!==void 0?t.state:!1,d=r&&r.block!==void 0?r.block:!0,w=s&&s.breaktime!==void 0?s.breaktime:0,S=o&&o.blocktime!==void 0?o.blocktime:0,R=l&&l.clock!==void 0?l.clock:0;e({state:u,block:d,time:R,blocktime:S,breaktime:w})}catch(t){console.log(t)}}function Re(e){try{y=e.timer-1;const t=e.blocktime,r=e.breaktime,s=e.isBlock;a.storage.local.set({blocktime:t}),a.storage.local.set({breaktime:r}),U=!0,V(!0),s?q(t,r):K(t,r)}catch(t){console.log(t)}}function q(e,t){y===0?(y=t,K(e,t)):(J=!0,ee(!0),h.GlobalPort&&h.GlobalPort.postMessage("blocktime"),j=setInterval(()=>{h.GlobalPort&&h.GlobalPort.postMessage(y),a.storage.local.set({clock:y}),y-=1,y===-1&&(y=t,clearInterval(j),K(e,t))},1e3))}function K(e,t){y===0?(y=e,q(e,t)):(J=!1,ee(!1),h.GlobalPort&&h.GlobalPort.postMessage("breaktime"),j=setInterval(()=>{h.GlobalPort&&h.GlobalPort.postMessage(y),a.storage.local.set({clock:y}),y-=1,y===-1&&(y=e,clearInterval(j),q(e,t))},1e3))}function je(e){clearInterval(j),U=!1,V(!1)}function Me(){clearInterval(j),U=!1,ee(!0),V(!1),a.storage.local.set({breaktime:0}),a.storage.local.set({blocktime:0})}async function _e(e){try{const t=await F("temp"),r=Object.keys(t).length?t:void 0;e(r)}catch{}}function Fe(e){try{return e?new URL(e).hostname:void 0}catch(t){console.log(t);return}}function le(e){try{if(!e)return;const r=new URL(e).hostname,s=r.split(".");return{name:s.length>2?s[1]:s[0],hostname:r}}catch(t){console.log(t);return}}function Oe(e){if(!e)return;const t=le(e);if(!t)return;let r,s=t.name;return r=Object.keys(L).find(l=>l.includes(t.hostname))?"distractive":"productive",{typeURL:r,website:s}}async function te(e,t,r){try{let{[e]:s}=await a.storage.local.get(e);s?s[t]=(s[t]||0)+r:s={[t]:r},console.log(`Saved ${e}`,s),a.storage.local.set({[e]:s})}catch(s){console.log(s)}}function Ue(e){try{O&&clearInterval(O),console.log("clear interval");const{typeURL:t,website:r}=e;if(r==="newtab")return;let s=15;O=setInterval(async()=>{if(console.log(s--),s===0){const l=new Date().getDay();te(t,X[l],.25),te("weekData",r,.25),te("dailyData",r,.25),s=15}},1e3)}catch(t){console.log(t)}}function ce(e){const t=Oe(e);if(!t){console.log("clear interval"),clearInterval(O);return}Ue(t)}async function Be(e){try{const{weekData:t}=await a.storage.local.get("weekData"),{distractive:r}=await a.storage.local.get("distractive"),{productive:s}=await a.storage.local.get("productive"),o=t?Object.entries(t).sort(([,d],[,w])=>w-d).slice(0,5):[],u={timeWebsite:Object.fromEntries(o),distractiveTime:r,productiveTime:s};e(u)}catch(t){console.log(t)}}async function Ie(){try{const{dailyData:e}=await a.storage.local.get("dailyData"),{distractive:t}=await a.storage.local.get("distractive"),{productive:r}=await a.storage.local.get("productive"),o=(e?Object.entries(e).sort(([,d],[,w])=>w-d).slice(0,5):[]).map(([d,w])=>`${d} : ${(parseFloat(w)/60).toFixed(30)} hours`).join(`
`),l=new Date().getDay(),u={dailywebsite:o,distractiveTime:t?t[X[l]]:0,productiveTime:r?r[X[l]]:0};return console.log("daily response",u),u}catch(e){console.log(e);return}}async function Ne(e){try{C=e.trackHistory,D=e.email,N=e.delay,B=e.useEmail,I=e.useDelay,a.storage.local.set({track_history:e.trackHistory}),a.storage.local.set({useEmail:e.useEmail}),a.storage.local.set({useDelay:e.useDelay}),a.storage.local.set({email:e.email}),a.storage.local.set({default_delay:e.delay}),console.log("updated!! ",e),C||(clearInterval(O),console.log("Clear interval"))}catch(t){console.log(t)}}async function He(e){try{const{track_history:t}=await a.storage.local.get("track_history"),{useEmail:r}=await a.storage.local.get("useEmail"),{useDelay:s}=await a.storage.local.get("useDelay"),{email:o}=await a.storage.local.get("email"),{default_delay:l}=await a.storage.local.get("default_delay");C=t!==void 0?t:!0,B=r!==void 0?r:!1,I=s!==void 0?s:!1,D=o||"",N=l||"";const u={trackHistory:C,useEmail:B,useDelay:I,email:D,delay:N};console.log("setting data ",u),e(u)}catch(t){console.log(t)}}async function We(){const{track_history:e}=await a.storage.local.get("track_history"),{useEmail:t}=await a.storage.local.get("useEmail"),{useDelay:r}=await a.storage.local.get("useDelay"),{email:s}=await a.storage.local.get("email"),{default_delay:o}=await a.storage.local.get("default_delay");C=e!==void 0?e:!0,B=t!==void 0?t:!1,I=r!==void 0?r:!1,D=s||"",N=o||""}class H{constructor(t=0,r="Network Error"){this.status=t,this.text=r}}const f={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}})()},re=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},$e=(e,t="https://api.emailjs.com")=>{if(!e)return;const r=re(e);f.publicKey=r.publicKey,f.blockHeadless=r.blockHeadless,f.storageProvider=r.storageProvider,f.blockList=r.blockList,f.limitRate=r.limitRate,f.origin=r.origin||t},ge=async(e,t,r={})=>{const s=await fetch(f.origin+e,{method:"POST",headers:r,body:t}),o=await s.text(),l=new H(s.status,o);if(s.ok)return l;throw l},me=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Ge=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},ue=e=>e.webdriver||!e.languages||e.languages.length===0,de=()=>new H(451,"Unavailable For Headless Browser"),Ve=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},qe=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},Ke=(e,t)=>e instanceof FormData?e.get(t):e[t],Ae=(e,t)=>{if(qe(e))return!1;Ve(e.list,e.watchVariable);const r=Ke(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)},fe=()=>new H(403,"Forbidden"),ze=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},Ze=async(e,t,r)=>{const s=Number(await r.get(e)||0);return t-Date.now()+s},be=async(e,t,r)=>{if(!t.throttle||!r)return!1;ze(t.throttle,t.id);const s=t.id||e;return await Ze(s,t.throttle,r)>0?!0:(await r.set(s,Date.now().toString()),!1)},ye=()=>new H(429,"Too Many Requests"),Ye=async(e,t,r,s)=>{const o=re(s),l=o.publicKey||f.publicKey,u=o.blockHeadless||f.blockHeadless,d=o.storageProvider||f.storageProvider,w={...f.blockList,...o.blockList},S={...f.limitRate,...o.limitRate};return u&&ue(navigator)?Promise.reject(de()):(me(l,e,t),Ge(r),r&&Ae(w,r)?Promise.reject(fe()):await be(location.pathname,S,d)?Promise.reject(ye()):ge("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:l,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))},Je=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Xe=e=>typeof e=="string"?document.querySelector(e):e,we={init:$e,send:Ye,sendForm:async(e,t,r,s)=>{const o=re(s),l=o.publicKey||f.publicKey,u=o.blockHeadless||f.blockHeadless,d=f.storageProvider||o.storageProvider,w={...f.blockList,...o.blockList},S={...f.limitRate,...o.limitRate};if(u&&ue(navigator))return Promise.reject(de());const R=Xe(r);me(l,e,t),Je(R);const E=new FormData(R);return Ae(w,E)?Promise.reject(fe()):await be(location.pathname,S,d)?Promise.reject(ye()):(E.append("lib_version","4.4.1"),E.append("service_id",e),E.append("template_id",t),E.append("user_id",l),ge("/api/v1.0/email/send-form",E))},EmailJSResponseStatus:H};h.GlobalPort=void 0,console.log("Hello from the background!"),a.runtime.onInstalled.addListener(e=>{console.log("Extension installed:",e)}),(async()=>(await Ee(),await Q(),await We(),st()))(),a.runtime.onMessage.addListener((e,t,r)=>{if(!t.tab)switch(e.action){case"create-new-card":e.data&&Pe(e.data);break;case"fetch-data-cards":return Se(r),!0;case"remove-card":Ce(e.data);break;case"create-new-timer":Re(e.data);break;case"delete-timer":je(e.data);break;case"reset-timer":Me();break;case"update-state":V(e.data);break;case"get-state":return De(r),!0;case"fetch-tempolary-data":return _e(r),!0;case"remove-tempolary-data":se();break;case"fetch-chart-data":return Be(r),!0;case"update-setting":Ne(e.data);break;case"get-setting-data":return He(r),!0}});let p="",T="",W=-1;function se(){T="",p="",W=-1}a.runtime.onConnect.addListener(e=>{h.GlobalPort=e,console.log("connect from ",e),(async()=>{var r,s;const t=await a.storage.local.get("temp");console.log("data stored: ",t),p=(r=t.temp)==null?void 0:r.target,T=(s=t.temp)==null?void 0:s.redirect,W=t.index})(),e.onMessage.addListener(t=>{t.action==="change-target"?t.data.content&&(p=t.data.content,W=t.data.index,console.log(p)):t.data.content&&(T=t.data.content,W=t.data.index,console.log(T))}),e.onDisconnect.addListener(async()=>{if(h.GlobalPort=void 0,console.log("value befored disconnect ",p,T),(p==null?void 0:p.length)===1&&(p=""),(T==null?void 0:T.length)===1&&(T=""),p||T){const t={index:W,target:p,redirect:T,tempolary:!0};await a.storage.local.set({temp:t}),console.log("save metadata successfully")}else await a.storage.local.remove("temp"),console.log("remove meta data")})}),a.tabs.onUpdated.addListener(async(e,t,r)=>{if(C&&ce(r.url),!U||!J||t.status!=="complete"||!r.url)return;const s=le(r.url);console.log(s);const o=Object.keys(L).find(l=>{var u;return(u=r.url)==null?void 0:u.includes(l)});if(o)if(L[o]===""){const l={active:I,delay:N};console.log("send data to content ",l);try{await a.tabs.sendMessage(e,l)}catch(u){console.error("Failed to send message to content script:",u)}}else a.tabs.update({url:L[o]})}),a.tabs.onActivated.addListener(async e=>{if(!C)return;const t=await a.tabs.get(e.tabId);t&&t.url&&(console.log("Active another tabs"),ce(t.url))});function Qe(){we.init({publicKey:"XToU1KzFwnW9N24iU"}),console.log("init emailjs")}async function et(e){try{const t=await we.send("digital-diet","template_u1axfy2",e);console.log("Email sent successfully!",t.status,t.text)}catch(t){console.error("Failed to send email:",t)}}function tt(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async function rt(){try{const e=await Ie();if(console.log(e),!e)return;if(console.log(D),!tt(D)){console.log("invalid email");return}return{to_name:D,productive:e.productiveTime,distractive:e.distractiveTime,website:e.dailywebsite,concetrate:(e.productiveTime/(e.productiveTime+e.distractiveTime)*100).toFixed(2)}}catch(e){console.log(e);return}}async function st(){try{const{recentOnline:e}=await a.storage.local.get("recentOnline");if(console.log("previous online",e),e){const r=new Date().getTime()-new Date(e).getTime(),s=Math.floor(r/(1e3*60*60*24));console.log("diffirent days:",s);const o=new Date(e).getDay(),l=new Date().getDay();if(console.log("today ",l,"yesterday ",o),o!==l){if(B){Qe();const u=await rt();u?await et(u):console.log("undefine or invalid mail")}a.storage.local.remove("dailyData")}(l!==o&&o===0||l<o&&l!==0||s>=7)&&(await a.storage.local.remove("distractive"),await a.storage.local.remove("productive"),await a.storage.local.remove("weekData"))}const t=new Date;a.storage.local.set({recentOnline:t.toString()})}catch(e){console.log(e)}}return h.ClearTempolaryVar=se,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});
